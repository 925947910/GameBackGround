<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yxb.cms.dao.MineralCodeMapper">
	<resultMap id="BaseResultMap"
		type="com.yxb.cms.domain.vo.mineralCode">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Aug 15 
			22:46:30 CST 2016. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="codeNo" property="codeNo" jdbcType="VARCHAR" />
		<result column="mineral" property="mineral" jdbcType="INTEGER" />
		<result column="status" property="status" jdbcType="INTEGER" />
		<result column="type" property="type" jdbcType="INTEGER" />
		<result column="codeDesc" property="codeDesc"
			jdbcType="VARCHAR" />
		<result column="uid" property="uid" jdbcType="INTEGER" />
	</resultMap>


	<!-- 查询用户总记录数 -->
	<select id="selectCountMineralCode"
		parameterType="com.yxb.cms.domain.vo.mineralCode" resultType="Long">
		select count(*)from mineralCode
		<include refid="selectPageParmas" />
	</select>
	<!-- 用户列表信息分页显示 -->
	<select id="selectMineralCodeListByPage"
		parameterType="com.yxb.cms.domain.vo.mineralCode"
		resultMap="BaseResultMap">
		select * from mineralCode
		<include refid="selectPageParmas" />
		order by id
		LIMIT #{start},#{limit}
	</select>

	<select id="getUserMineral" parameterType="java.lang.Integer"
		resultType="com.yxb.cms.domain.po.userMineral">
		select * from
		userMineral where uid=#{uid}
	</select>


	<!-- 查询条件 -->
	<sql id="selectPageParmas">
		<where>
			<if
				test="searchTerm != null and searchTerm != '' and searchContent != null and  searchContent != '' and  searchTerm == 'uidTerm' ">
				AND uid= #{searchContent,jdbcType=INTEGER}
			</if>
			<if
				test="searchTerm != null and searchTerm != '' and searchContent != null and  searchContent != '' and  searchTerm == 'statusTerm' ">
				AND status= #{searchContent,jdbcType=INTEGER}
			</if>

		</where>
	</sql>

	<insert id="insertMineralCode"
		parameterType="com.yxb.cms.domain.vo.mineralCode">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. This element was generated on Mon Aug 15 
			22:46:30 CST 2016. -->
		insert into mineralCode ( codeNo, mineral, status, codeDesc, type)
		values (#{codeNo,jdbcType=VARCHAR}, #{mineral,jdbcType=INTEGER},
		#{status,jdbcType=INTEGER},
		#{codeDesc,jdbcType=VARCHAR},
		#{type,jdbcType=VARCHAR}
		)

	</insert>
	<insert id="insertMineral">
		insert into userMineral(uid,mineral) values
		(#{uid,jdbcType=INTEGER},#{mineral,jdbcType=INTEGER})
	</insert>
	<insert id="writeMineralBills"
		parameterType="com.yxb.cms.domain.po.mineralBills">
		insert into
		mineralBills(id,nick,uid,mineral,cost,freeze,type,tagId,reason,time)
		values
		(#{id,jdbcType=INTEGER},#{nick,jdbcType=VARCHAR},#{uid,jdbcType=INTEGER},#{mineral,jdbcType=INTEGER},#{cost,jdbcType=INTEGER},#{freeze,jdbcType=INTEGER},#{type,jdbcType=INTEGER},#{tagId,jdbcType=INTEGER},#{reason,jdbcType=VARCHAR},#{time,jdbcType=BIGINT})
	</insert>
	<delete id="delMineralCode" parameterType="java.lang.Integer">
		delete from
		mineralCode
		where id = #{id,jdbcType=INTEGER}
	</delete>

	<update id="failedMineralCode" parameterType="java.lang.Integer">
		update mineralCode
		set status = 2
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateMineralNum">
		update userMineral set mineral=
		#{mineral,jdbcType=INTEGER},version=
		#{version,jdbcType=INTEGER}+1
		where version=
		#{version,jdbcType=INTEGER} and
		uid=#{uid,jdbcType=INTEGER}
	</update>
</mapper>